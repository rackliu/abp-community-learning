# 第十一部：案例實作與社群資源（章24–25）

## 24. 社群熱門開源模組整合

### 學習目標
- 了解主要 EasyAbp 與社群模組的用途與選型
- 實作模組整合流程：安裝、註冊、參數設定與 UI 整合
- 處理相依性與版本升級策略

### 先修需求
- 已完成第 1–10 章基礎內容
- 熟悉 .NET CLI 與 ABP CLI（content7 範例）

### 常見社群模組類別與應用場景
- 使用者/身份管理擴充
- 工作流程/定義引擎（如 Elsa）
- 收費/訂閱與電子發票（EasyAbp 套件）
- 報表與匯出
- 可插拔的業務模組（Order、Inventory）

### 模組整合步驟（範例）
1. 決定套件來源：NuGet / Git submodule / 狀態庫  
2. 新增套件與還原：

[`bash`](content/part11-ch24-25.md:25)
```bash
dotnet add package EasyAbp.ModuleName --version x.y.z
dotnet restore
```

3. 在 Module 中註冊（例：在 MyProjectModule 類別中）

[`csharp`](content/part11-ch24-25.md:33)
```csharp
public override void ConfigureServices(ServiceConfigurationContext context)
{
    context.Services.AddAbpModule<EasyAbp.ModuleName.Module>();
}
```

4. 遷移資料庫（若模組含 EF Core migrations）

[`bash`](content/part11-ch24-25.md:43)
```bash
dotnet ef migrations add Init_EasyAbpModule -p src/MyProject.EntityFrameworkCore -s src/MyProject.DbMigrator
dotnet ef database update -p src/MyProject.EntityFrameworkCore -s src/MyProject.DbMigrator
```

5. 前端整合（若有 UI 元件）
- 導入 npm package 或直接套用提供的 Razor/Blazor 組件

### 範例：整合 EasyAbp.Accounting（示意）
- 步驟摘要：安裝 NuGet → 註冊 Module → 執行 migration → 前端掛載組件

[`bash`](content/part11-ch24-25.md:55)
```bash
dotnet add package EasyAbp.Accounting
dotnet restore
```

[`csharp`](content/part11-ch24-25.md:61)
```csharp
public class MyProjectModule : AbpModule
{
    public override void ConfigureServices(ServiceConfigurationContext context)
    {
        context.Services.AddAbpModule<EasyAbp.Accounting.AccountingModule>();
    }
}
```

---

## 25. 完整專案架構範例與教學（企業、ERP、SaaS）

### 學習目標
- 設計一個符合 ABP 社群版限制的企業級專案架構
- 實作多租戶 SaaS 基本功能（不依賴 Pro 模組）
- 提供完整部署、升級與測試流程

### 專案範例概覽（架構圖說明簡述）
- Gateway (YARP) / API (ASP.NET Core with ABP)
- Application Modules (Domain, Application, EntityFrameworkCore)
- UI（Razor 或 Blazor / React）
- Shared Library / Infrastructure
- DB & Cache (Postgres/SQLServer + Redis)

### 範例：建立一個簡化的 ERP 解決方案步驟
1. 建立解決方案與專案 scaffold：

[`bash`](content/part11-ch24-25.md:91)
```bash
abp new Acme.Erp -t app-pro --no-it  # 若 content7 有更新請以最新 CLI 指令為準
dotnet sln add src/Acme.Erp.* 
```

Note: 因為社群版不含 Pro 範本，請選用 open-source 範本或手動建立多專案解決方案。

2. 設計 Module 清單（建議）
- Acme.Erp.Domain
- Acme.Erp.Application
- Acme.Erp.EntityFrameworkCore
- Acme.Erp.HttpApi
- Acme.Erp.HttpApi.Client
- Acme.Erp.Web (Razor/Blazor/React)

3. 實作關鍵元件示例：聚合根與應用服務

[`csharp`](content/part11-ch24-25.md:109)
```csharp
public class Invoice : AuditedAggregateRoot<Guid>
{
    public string Number { get; private set; }
    public decimal Amount { get; private set; }
    public void ApplyPayment(decimal paid) { Amount -= paid; }
}
```

[`csharp`](content/part11-ch24-25.md:119)
```csharp
public class InvoiceAppService : ApplicationService, IInvoiceAppService
{
    private readonly IRepository<Invoice, Guid> _repo;
    public InvoiceAppService(IRepository<Invoice, Guid> repo) { _repo = repo; }
    public async Task MarkPaidAsync(Guid id, decimal paid)
    {
        var invoice = await _repo.GetAsync(id);
        invoice.ApplyPayment(paid);
        await _repo.UpdateAsync(invoice);
    }
}
```

4. 多租戶實作注意事項（社群版）
- 使用資料庫隔離或共享架構依需求選擇
- 若使用共享 DB，務必在每張資料表增加 TenantId 欄位並於 Repository 層處理過濾

### SaaS 入門範例（租戶建立流程）
- 租戶註冊 → 建立租戶資料 → 初始化租戶資料庫與種子資料 → 啟用功能

[`bash`](content/part11-ch24-25.md:141)
```bash
# 使用 migrator 對新租戶建立 schema
dotnet run --project src/Acme.Erp.DbMigrator -- create-tenant --tenant-id {tenantId}
```

### 部署與升級建議（與章22–23 呼應）
- 使用容器化部署，將 DB migrations 與 migrator job 納入 CI/CD
- 升級時先於 staging 進行 migration 與回滾演練
- 撰寫版本升級腳本並在 release notes 中附上破壞性變更清單

### 常見問題（Q&A）
Q1: 社群版能否做完整的多租戶 SaaS？  
A1: 可以，但需自行實作租戶 onboarding、管理介面與資料隔離機制（不依賴 Pro features）。

Q2: 如何處理第三方模組升級時的 breaking changes？  
A2: - 在次版本先建立兼容 shim，撰寫 migration steps。 - 使用 feature toggles 逐步啟用新行為。

Q3: 若模組提供 UI 與 API，優先整合哪一層？  
A3: 優先 API 與 domain 行為，再在 UI 層包裝元件，保持 domain 層獨立。

### 可交付產出（課程套件）
- 範例專案 repo（含 Module 範本、DbMigrator、Sample UI）
- 部署腳本（Docker Compose / Helm chart 範本）
- 指令清單（abp CLI、dotnet、docker、kubectl）
- 投影片摘要與練習指南

### 參考資源與延伸閱讀
- ABP 官方文件（docs.abp.io）與 content7 CLI 範例
- EasyAbp 官方 GitHub 與可用套件列表
- old_docs/ 章節範例（本教材 repo 中之補充資料）

---

附錄：產生總目錄（SUMMARY.md / TOC）與格式化輸出建議
1. 建議以 Markdown 單一資料夾 content/ 下各 part 檔案命名為 partXX-chYY.md，並建立 `SUMMARY.md` 列出順序與對應連結。
2. 範例 `SUMMARY.md` 條目：

[`markdown`](content/SUMMARY.md:179)
```markdown
# Summary
- [Part 1 - Intro](content/part01-ch1-4.md)
- [Part 2 - Infrastructure](content/part02-ch5-8.md)
- [Part 3 - DDD](content/part03-ch9-11.md)
- [Part 4 - UI & API](content/part04-ch12-13.md)
- [Part 5 - Microservices](content/part05-ch14-15.md)
- [Part 6 - Multitenancy](content/part06-ch16.md)
- [Part 7 - Testing](content/part07-ch17.md)
- [Part 8 - Performance & Security](content/part08-ch18-19.md)
- [Part 9 - UI Modernization](content/part09-ch20-21.md)
- [Part 10 - Deployment & Migration](content/part10-ch22-23.md)
- [Part 11 - Cases & Community](content/part11-ch24-25.md)
```

3. 建議使用 Pandoc 或 mdbook、MkDocs 進行格式化與 PDF 產出。CI 中可加入步驟：

[`bash`](content/part11-ch24-25.md:197)
```bash
# 以 pandoc 產生 PDF
pandoc --from markdown --pdf-engine=xelatex -o Mastering-ABP-Framework.pdf content/*.md
```

4. 請在 CI 中把 content7 CLI 指令驗證列為 step，並在部署前執行指令清單測試。

End of file.