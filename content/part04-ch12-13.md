# 第四部：使用者介面與 API 開發（章 12–13）

本檔為教材第四部（章 12–13）教學草稿，涵蓋 MVC/Razor Pages、Blazor WebAssembly（社群版功能）、主題、資源管理、Bundling、NPM 與 API 代理相關實作與最佳實務。

## 學習目標
- 掌握 Razor/MVC 頁面設計、TagHelper 與分頁實作
- 能使用 ABP 自動產生 API 代理並整合至前端
- 理解 Blazor WebAssembly 架構、組件設計與限制（社群版）
- 能設定資源管理、Bundling 與 NPM 工作流程

## 12 MVC/Razor Pages 前端開發
### 頁面與 TagHelper
- 使用 ABP 提供的 TagHelpers 建立一致性 UI
- 範例：建立圖書清單分頁

```csharp
// csharp
// BooksAppService.cs (Application 層)
public async Task<PagedResultDto<BookDto>> GetListAsync(GetBookListDto input)
{
    var list = await _bookRepository.GetPagedListAsync(input.SkipCount, input.MaxResultCount);
    return new PagedResultDto<BookDto>(await _bookRepository.CountAsync(), ObjectMapper.Map<List<Book>, List<BookDto>>(list));
}
```

```html
<!-- razor -->
<abp-table items="@Model.Books" />
```

### Bundling / Minification
- 使用 npm 管理前端套件並整合至 ABP 的打包流程
```bash
npm install
npm run build
```

### 動態代理與 JavaScript API
- 使用 `abp generate-proxy` 產生前端 API 代理（TypeScript/JS）

```bash
abp generate-proxy -t ng
```

## 13 Blazor WebAssembly UI（社群版）
### 基本架構與組件設計
- 支援 Blazor Server 與 WebAssembly 混合模式，但某些商業主題不可用
- 建議組件設計：拆小、可重用、注意 JS 互操作

### 範例：簡單組件
```csharp
// csharp
public partial class BookList : ComponentBase
{
    [Inject] public IBookAppService BookAppService { get; set; }
    private List<BookDto> Books;
    protected override async Task OnInitializedAsync() => Books = await BookAppService.GetListAsync(new GetBookListDto());
}
```

### 限制與考量
- 避免在 Blazor WebAssembly 中執行大量同步 I/O
- 注意靜態資源大小與載入時間（使用 Lazy loading 與分割打包）

## 最佳實務
- 建立統一的 UI 元件庫以降低重複工作
- API 代理自動化：在 CI 中執行生成代理的指令
- 將前端建置步驟納入 CI/CD 流程

## 常見問題
Q：如何在 MVC 頁面使用 API 代理？  
A：生成 TypeScript/JS 代理後，在前端載入並呼叫，例如：`Api.Book.GetList()`。

## 參考資源
- ABP UI 文件：https://docs.abp.io/en/abp/latest/UI
- Blazor 文件：https://dotnet.microsoft.com/apps/aspnet/web-apps/blazor