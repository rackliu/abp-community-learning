# 第九部：UI 現代化與主題客製（章 20–21）

本檔為章 20–21 教材草稿，涵蓋 React 基礎 UI、組件設計、模組聯邦概念，以及 LeptonX Lite 主題自訂與深色/淺色模式設定（社群版）。

## 學習目標
- 理解如何在 ABP 專案中使用 React 作為前端
- 設計可重用的 React 組件並整合 ABP API 代理
- 了解 Module Federation（模組聯邦）基礎概念與適用場景
- 能客製化 LeptonX Lite 主題並實作深色/淺色切換

## 先修需求
- 基本 React、TypeScript、Webpack 或 Vite 概念
- 熟悉 ABP 的 API 與前端代理生成流程

## 20 React 基礎 UI 開發

### 專案結構（建議）
- src/
  - components/
  - pages/
  - services/ (API 呼叫封裝)
  - utils/

### 建立 React App 並整合 ABP API
建議使用 Vite 或 Create React App：

```bash
# bash
npm create vite@latest my-app --template react-ts
cd my-app
npm install
```

### 範例：封裝 API 呼叫（使用 TypeScript）
```javascript
// javascript
import axios from 'axios';
import { Api } from '@/abp-proxy'; // 產生後的 API 代理

export async function fetchBooks() {
  const result = await Api.book.getList();
  return result;
}
```

### React 組件設計原則
- 小而專注：每個組件只處理單一責任
- 使用 hooks（如 useEffect/useState/useMemo）封裝邏輯
- 對外依賴透過 props 或 context 注入以利測試

### 組件範例：BookList
```javascript
// javascript
import React, { useEffect, useState } from 'react';
import { fetchBooks } from '@/services/book';

export function BookList() {
  const [books, setBooks] = useState([]);
  useEffect(() => {
    fetchBooks().then(b => setBooks(b.items || []));
  }, []);
  return (
    <div>
      <h2>Books</h2>
      <ul>{books.map(b => <li key={b.id}>{b.title}</li>)}</ul>
    </div>
  );
}
```

### 模組聯邦（Module Federation）簡介
- 適用於大型平台要在執行時載入遠端應用或共用組件
- 使用 Webpack Module Federation 或基於 Vite 的相容方案
- 注意版本衝突與共享依賴（React、ReactDOM）

## 21 LeptonX Lite 主題（社群版）

### LeptonX Lite 簡介
- 社群可用的輕量主題，支援基本樣式、顏色主題與佈局
- 可透過前端覆寫 CSS 或替換 SCSS 變數快速自訂

### 基本自訂步驟
1. 在 Web 專案的 wwwroot 或前端專案安裝主題資源（npm 或複製檔案）
2. 覆寫 CSS 變數或 SCSS 變數
3. 在 layout 中注入自訂樣式

範例：設定深色/淺色模式（React）
```javascript
// javascript
import React, { useState, useEffect } from 'react';
export function ThemeToggle() {
  const [dark, setDark] = useState(false);
  useEffect(() => {
    document.documentElement.setAttribute('data-theme', dark ? 'dark' : 'light');
  }, [dark]);
  return <button onClick={() => setDark(!dark)}>{dark ? 'Light' : 'Dark'}</button>;
}
```

### 深度客製建議
- 將樣式變數集中管理，提供主題配置檔（JSON）
- 提供 runtime 主題切換函式並保存使用者偏好（localStorage 或後端）
- 測試不同解析度與可及性（對比度、字型大小）

### 與 ABP 整合重點
- 在 ABP 模板中使用 `abp generate-proxy` 產生 API 代理，並在 React 中引用（見章 12）  
  - 參考檔案：[`content/part04-ch12-13.md`](content/part04-ch12-13.md:1)
- 將前端建置步驟加入 CI（npm ci && npm run build），部署到 wwwroot 或獨立靜態 host

## 最佳實務與常見問題
- 避免在前端與後端重複驗證邏輯，後端仍為權威
- Module Federation 適合多團隊共建平台，但需良好版本治理
- LeptonX Lite 為社群版主題，若需要商業主題功能請留意授權與相容性

## 參考資源
- React 官方：https://reactjs.org  
- Module Federation：https://webpack.js.org/concepts/module-federation/  
- LeptonX Theme 文件與範例：ABP 官方 UI 文件（章 12）

檔案：[`content/part09-ch20-21.md`](content/part09-ch20-21.md:1)